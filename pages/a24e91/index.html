<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker 高级实践篇 | Evan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.6732922a.css" as="style"><link rel="preload" href="/assets/js/app.b837e983.js" as="script"><link rel="preload" href="/assets/js/2.4c5c8fbd.js" as="script"><link rel="preload" href="/assets/js/72.5ba525c3.js" as="script"><link rel="prefetch" href="/assets/js/10.2694d36c.js"><link rel="prefetch" href="/assets/js/100.2f320a93.js"><link rel="prefetch" href="/assets/js/101.31da5d74.js"><link rel="prefetch" href="/assets/js/102.8ebe7f05.js"><link rel="prefetch" href="/assets/js/103.c943a5f6.js"><link rel="prefetch" href="/assets/js/104.b60d826a.js"><link rel="prefetch" href="/assets/js/105.1696773d.js"><link rel="prefetch" href="/assets/js/106.eae309a7.js"><link rel="prefetch" href="/assets/js/107.bfb7f78f.js"><link rel="prefetch" href="/assets/js/108.ec5ee8ef.js"><link rel="prefetch" href="/assets/js/109.5024a366.js"><link rel="prefetch" href="/assets/js/11.3719204c.js"><link rel="prefetch" href="/assets/js/110.f946daf9.js"><link rel="prefetch" href="/assets/js/111.7a69bdcc.js"><link rel="prefetch" href="/assets/js/112.dcdb3a5a.js"><link rel="prefetch" href="/assets/js/113.8ec8ceef.js"><link rel="prefetch" href="/assets/js/114.aee7f367.js"><link rel="prefetch" href="/assets/js/115.7a0c6e09.js"><link rel="prefetch" href="/assets/js/116.7a0ab903.js"><link rel="prefetch" href="/assets/js/117.5571fc1a.js"><link rel="prefetch" href="/assets/js/118.8af761ee.js"><link rel="prefetch" href="/assets/js/119.1ad01e6a.js"><link rel="prefetch" href="/assets/js/12.b8c146ee.js"><link rel="prefetch" href="/assets/js/120.3e8f36db.js"><link rel="prefetch" href="/assets/js/121.adaf5a47.js"><link rel="prefetch" href="/assets/js/122.a52f98ab.js"><link rel="prefetch" href="/assets/js/123.7da9c65e.js"><link rel="prefetch" href="/assets/js/124.8173a20f.js"><link rel="prefetch" href="/assets/js/125.66c21c7b.js"><link rel="prefetch" href="/assets/js/126.6fce0578.js"><link rel="prefetch" href="/assets/js/127.1253b8ae.js"><link rel="prefetch" href="/assets/js/128.38893737.js"><link rel="prefetch" href="/assets/js/129.fe4f9bc1.js"><link rel="prefetch" href="/assets/js/13.ef3c3ee5.js"><link rel="prefetch" href="/assets/js/130.cc404683.js"><link rel="prefetch" href="/assets/js/131.a45a1494.js"><link rel="prefetch" href="/assets/js/132.c865deaf.js"><link rel="prefetch" href="/assets/js/133.5a39dda1.js"><link rel="prefetch" href="/assets/js/134.fd563475.js"><link rel="prefetch" href="/assets/js/135.f384514b.js"><link rel="prefetch" href="/assets/js/136.885853d4.js"><link rel="prefetch" href="/assets/js/137.011b88d1.js"><link rel="prefetch" href="/assets/js/138.74cd8edc.js"><link rel="prefetch" href="/assets/js/139.3a754685.js"><link rel="prefetch" href="/assets/js/14.f7c55b4c.js"><link rel="prefetch" href="/assets/js/140.02b89f0d.js"><link rel="prefetch" href="/assets/js/141.bc1233f3.js"><link rel="prefetch" href="/assets/js/142.85455350.js"><link rel="prefetch" href="/assets/js/143.ec5074d8.js"><link rel="prefetch" href="/assets/js/144.9aa1c780.js"><link rel="prefetch" href="/assets/js/145.83acaa33.js"><link rel="prefetch" href="/assets/js/146.09c690f8.js"><link rel="prefetch" href="/assets/js/147.1081f9ee.js"><link rel="prefetch" href="/assets/js/148.4fefd78f.js"><link rel="prefetch" href="/assets/js/15.eb3073e0.js"><link rel="prefetch" href="/assets/js/16.a76f3aa1.js"><link rel="prefetch" href="/assets/js/17.21cffd14.js"><link rel="prefetch" href="/assets/js/18.412c079a.js"><link rel="prefetch" href="/assets/js/19.f7ec127c.js"><link rel="prefetch" href="/assets/js/20.ee23c0a2.js"><link rel="prefetch" href="/assets/js/21.6996f638.js"><link rel="prefetch" href="/assets/js/22.fb5cb604.js"><link rel="prefetch" href="/assets/js/23.9a79f539.js"><link rel="prefetch" href="/assets/js/24.c4098bb2.js"><link rel="prefetch" href="/assets/js/25.26896566.js"><link rel="prefetch" href="/assets/js/26.b3b7b1f8.js"><link rel="prefetch" href="/assets/js/27.fd041e92.js"><link rel="prefetch" href="/assets/js/28.00a16fa2.js"><link rel="prefetch" href="/assets/js/29.857c5a00.js"><link rel="prefetch" href="/assets/js/3.a94bca7d.js"><link rel="prefetch" href="/assets/js/30.73ac0d38.js"><link rel="prefetch" href="/assets/js/31.e96f7fa9.js"><link rel="prefetch" href="/assets/js/32.b54e1d09.js"><link rel="prefetch" href="/assets/js/33.70ac53c5.js"><link rel="prefetch" href="/assets/js/34.4b1df614.js"><link rel="prefetch" href="/assets/js/35.1eaabd73.js"><link rel="prefetch" href="/assets/js/36.a932f2cd.js"><link rel="prefetch" href="/assets/js/37.b7c9eee0.js"><link rel="prefetch" href="/assets/js/38.f29e7739.js"><link rel="prefetch" href="/assets/js/39.6f8dd3dc.js"><link rel="prefetch" href="/assets/js/4.3c076cc1.js"><link rel="prefetch" href="/assets/js/40.55f4566a.js"><link rel="prefetch" href="/assets/js/41.b73ba281.js"><link rel="prefetch" href="/assets/js/42.3d43de4e.js"><link rel="prefetch" href="/assets/js/43.7c72be71.js"><link rel="prefetch" href="/assets/js/44.e6fd7e4c.js"><link rel="prefetch" href="/assets/js/45.80270188.js"><link rel="prefetch" href="/assets/js/46.20881084.js"><link rel="prefetch" href="/assets/js/47.975d4d88.js"><link rel="prefetch" href="/assets/js/48.74b7de4e.js"><link rel="prefetch" href="/assets/js/49.badbc0fd.js"><link rel="prefetch" href="/assets/js/5.77642dd8.js"><link rel="prefetch" href="/assets/js/50.4c105fff.js"><link rel="prefetch" href="/assets/js/51.9abe30b9.js"><link rel="prefetch" href="/assets/js/52.e8a23d07.js"><link rel="prefetch" href="/assets/js/53.72a6cd8e.js"><link rel="prefetch" href="/assets/js/54.e82b0c33.js"><link rel="prefetch" href="/assets/js/55.75b451fd.js"><link rel="prefetch" href="/assets/js/56.e4958db2.js"><link rel="prefetch" href="/assets/js/57.90fed293.js"><link rel="prefetch" href="/assets/js/58.3412ea23.js"><link rel="prefetch" href="/assets/js/59.4cad326e.js"><link rel="prefetch" href="/assets/js/6.0dcf2416.js"><link rel="prefetch" href="/assets/js/60.f2348707.js"><link rel="prefetch" href="/assets/js/61.2c0c6474.js"><link rel="prefetch" href="/assets/js/62.574572aa.js"><link rel="prefetch" href="/assets/js/63.869a5e31.js"><link rel="prefetch" href="/assets/js/64.6674fe0f.js"><link rel="prefetch" href="/assets/js/65.eb4ae566.js"><link rel="prefetch" href="/assets/js/66.bb3034c1.js"><link rel="prefetch" href="/assets/js/67.3d0675a9.js"><link rel="prefetch" href="/assets/js/68.f26479fb.js"><link rel="prefetch" href="/assets/js/69.93558cf9.js"><link rel="prefetch" href="/assets/js/7.a75b65b8.js"><link rel="prefetch" href="/assets/js/70.bb053e81.js"><link rel="prefetch" href="/assets/js/71.f4528d3f.js"><link rel="prefetch" href="/assets/js/73.08ec93e0.js"><link rel="prefetch" href="/assets/js/74.67c820b8.js"><link rel="prefetch" href="/assets/js/75.e1943010.js"><link rel="prefetch" href="/assets/js/76.11be7c8b.js"><link rel="prefetch" href="/assets/js/77.1d3b70d3.js"><link rel="prefetch" href="/assets/js/78.4ad08222.js"><link rel="prefetch" href="/assets/js/79.b4d6f026.js"><link rel="prefetch" href="/assets/js/8.f4f061ea.js"><link rel="prefetch" href="/assets/js/80.d75266c6.js"><link rel="prefetch" href="/assets/js/81.d4af5bdc.js"><link rel="prefetch" href="/assets/js/82.269e822a.js"><link rel="prefetch" href="/assets/js/83.832e599a.js"><link rel="prefetch" href="/assets/js/84.7161e44a.js"><link rel="prefetch" href="/assets/js/85.ae7f4784.js"><link rel="prefetch" href="/assets/js/86.73f1fdb5.js"><link rel="prefetch" href="/assets/js/87.7be81e9b.js"><link rel="prefetch" href="/assets/js/88.5982c51e.js"><link rel="prefetch" href="/assets/js/89.04918212.js"><link rel="prefetch" href="/assets/js/9.33677648.js"><link rel="prefetch" href="/assets/js/90.209e9382.js"><link rel="prefetch" href="/assets/js/91.d4efdeba.js"><link rel="prefetch" href="/assets/js/92.3d95507d.js"><link rel="prefetch" href="/assets/js/93.a31ff5cc.js"><link rel="prefetch" href="/assets/js/94.360eda5d.js"><link rel="prefetch" href="/assets/js/95.c506b4a2.js"><link rel="prefetch" href="/assets/js/96.b41c419b.js"><link rel="prefetch" href="/assets/js/97.faa87049.js"><link rel="prefetch" href="/assets/js/98.fb7904dd.js"><link rel="prefetch" href="/assets/js/99.86a0a480.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6732922a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Evan's blog" class="logo"> <span class="site-name can-hide">Evan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">Java基础</a></li><li class="dropdown-item"><h4>Java高级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">Java并发</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">Java虚拟机</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">JDK新特性</a></li></ul></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">Java Web</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">计算机网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring MVC</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring Cloud</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring Cloud Alibaba</a></li><li class="dropdown-item"><!----> <a href="/pages/c55839/" class="nav-link">Spring Security</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Mybatis Plus</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Apollo</a></li><li class="dropdown-item"><h4>大数据</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/261b24/" class="nav-link">Hbase</a></li><li class="dropdown-subitem"><a href="/pages/c55839/" class="nav-link">Spark</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">ClickHouse</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front-end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Webpack</a></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">Vue Router</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">Vuex</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">ES6</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构" class="dropdown-title"><a href="/design/" class="link-title">架构</a> <span class="title" style="display:none;">架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/operation/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Shell脚本</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tools/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">SVN</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Idea</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Windows</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">分布式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/technology/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>前端界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">Java基础</a></li><li class="dropdown-item"><h4>Java高级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">Java并发</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">Java虚拟机</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">JDK新特性</a></li></ul></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">Java Web</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/note/es6/" class="nav-link">计算机网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><!----> <span class="title" style="display:;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring MVC</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring Cloud</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Spring Cloud Alibaba</a></li><li class="dropdown-item"><!----> <a href="/pages/c55839/" class="nav-link">Spring Security</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Mybatis Plus</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Mysql</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Apollo</a></li><li class="dropdown-item"><h4>大数据</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/261b24/" class="nav-link">Hbase</a></li><li class="dropdown-subitem"><a href="/pages/c55839/" class="nav-link">Spark</a></li><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">ClickHouse</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front-end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Webpack</a></li><li class="dropdown-item"><h4>Vue</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8309a5b876fc95e3/" class="nav-link">Vue Router</a></li><li class="dropdown-subitem"><a href="/pages/0a83b083bdf257cb/" class="nav-link">Vuex</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">ES6</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构" class="dropdown-title"><a href="/design/" class="link-title">架构</a> <span class="title" style="display:none;">架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/operation/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Shell脚本</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Kubernetes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tools/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Maven</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">SVN</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Idea</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Windows</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/back-end/" class="nav-link">分布式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/technology/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell脚本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tomcat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/261b24/" class="sidebar-link">Docker 初级篇</a></li><li><a href="/pages/5ca863/" class="sidebar-link">Docker 中级篇</a></li><li><a href="/pages/a24e91/" aria-current="page" class="active sidebar-link">Docker 高级实践篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a24e91/#docker安装nginx" class="sidebar-link">Docker安装Nginx</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#docker安装tomcat" class="sidebar-link">Docker安装Tomcat</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#docker部署es-kibana·" class="sidebar-link">Docker部署es + kibana·</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#可视化" class="sidebar-link">可视化</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#docker的理解回顾" class="sidebar-link">Docker的理解回顾</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#使用数据卷" class="sidebar-link">使用数据卷</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#实战-安装mysql" class="sidebar-link">实战：安装MySQL</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#匿名和具名挂载-容器卷" class="sidebar-link">匿名和具名挂载（容器卷）</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#数据卷容器" class="sidebar-link">数据卷容器</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#dockerfile" class="sidebar-link">DockerFile</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#dockerfile的构建过程" class="sidebar-link">DockerFile的构建过程</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#dockerfile指令说明" class="sidebar-link">DockerFile指令说明</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#创建一个自己的centos" class="sidebar-link">创建一个自己的Centos</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a24e91/#cmd-和entrypoint区别" class="sidebar-link">CMD 和ENTRYPOINT区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#制作tomcat镜像" class="sidebar-link">制作Tomcat镜像</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#发布自己的镜像到docker-hub" class="sidebar-link">发布自己的镜像到Docker Hub</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#发布到阿里云镜像服务上" class="sidebar-link">发布到阿里云镜像服务上</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#连接-docker0" class="sidebar-link">连接 Docker0</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#link" class="sidebar-link">-- link</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#自定义网络" class="sidebar-link">自定义网络</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#网络连通-不同网络之间" class="sidebar-link">网络连通（不同网络之间）</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#实战-部署redis" class="sidebar-link">实战：部署redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/a24e91/#实战一-bridge网络-docker" class="sidebar-link">实战一（bridge网络 + docker）</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#实战二-host网络-docker-compose" class="sidebar-link">实战二（host网络 + docker-compose）</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#springboot微服务打包docker镜像" class="sidebar-link">SpringBoot微服务打包Docker镜像</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#yaml规则" class="sidebar-link">yaml规则</a></li><li class="sidebar-sub-header"><a href="/pages/a24e91/#实战-自己编写微服务上线" class="sidebar-link">实战：自己编写微服务上线</a></li></ul></li><li><a href="/pages/8a7664/" class="sidebar-link">Docker 网络模式和容器间通信</a></li><li><a href="/pages/457953/" class="sidebar-link">Docker 搭建 Redis Cluster 集群</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>kubernetes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=%E8%BF%90%E7%BB%B4" title="分类" data-v-0c557b5e>运维</a></li><li data-v-0c557b5e><a href="/categories/?category=Docker" title="分类" data-v-0c557b5e>Docker</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/xugaoyi" target="_blank" title="作者" class="beLink" data-v-0c557b5e>xugaoyi</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-02-03</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Docker 高级实践篇<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="docker部署软件实战"><a href="#docker部署软件实战" class="header-anchor">#</a> Docker部署软件实战</h1> <h2 id="docker安装nginx"><a href="#docker安装nginx" class="header-anchor">#</a> Docker安装Nginx</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1. 搜索镜像 docker search, 建议去docker hub搜索，可以看到帮助文档</span>
<span class="token comment"># 2. 下载镜像 docker pull</span>
<span class="token comment"># 3. 运行测试</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
centos              latest              0d120b6ccaa8        <span class="token number">32</span> hours ago        215MB
nginx               latest              08393e824c32        <span class="token number">7</span> days ago          132MB

<span class="token comment"># -d 后台运行</span>
<span class="token comment"># -name 给容器命名</span>
<span class="token comment"># -p 宿主机端口：容器内部端口</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker run -d --name nginx01 -p 3344:80 nginx	# 后台方式启动启动镜像</span>
fe9dc33a83294b1b240b1ebb0db9cb16bda880737db2c8a5c0a512fc819850e0
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
fe9dc33a8329        nginx               <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">4</span> seconds ago       Up <span class="token number">4</span> seconds        <span class="token number">0.0</span>.0.0:3344-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx01
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># curl localhost:3344	# 本地访问测试</span>
<span class="token comment"># 进入容器</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker exec -it nginx01 /bin/bash</span>
root@fe9dc33a8329:/<span class="token comment"># whereis nginx</span>
nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx
root@fe9dc33a8329:/<span class="token comment"># cd /etc/nginx/</span>
root@fe9dc33a8329:/etc/nginx<span class="token comment"># ls</span>
conf.d		koi-utf  mime.types  nginx.conf   uwsgi_params
fastcgi_params	koi-win  modules     scgi_params  win-utf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>端口暴露原理图</strong></p> <p><img src="https://img-blog.csdnimg.cn/20200812111035666.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70" alt="img"></p> <h2 id="docker安装tomcat"><a href="#docker安装tomcat" class="header-anchor">#</a> Docker安装Tomcat</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 官方的使用</span>
<span class="token comment"># docker run -it --rm 一般用来测试，用完就删</span>
<span class="token function">docker</span> run -it --rm tomcat:9.0

<span class="token comment"># 下载再启动</span>
<span class="token function">docker</span> pull tomcat
<span class="token comment"># 启动运行</span>
<span class="token function">docker</span> run -d -p <span class="token number">3344</span>:8080 --name tomcat01 tomcat
<span class="token comment"># 进入容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat01 /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="docker部署es-kibana·"><a href="#docker部署es-kibana·" class="header-anchor">#</a> Docker部署es + kibana·</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># es 暴露的端口很多</span>
<span class="token comment"># es 十分的耗内存</span>
<span class="token comment"># es 的数据一般需要放置到安全目录！ 挂载</span>
<span class="token comment"># --net somenetwork	网络配置</span>

<span class="token comment"># 启动elasticsearch， docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span>

<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span>
a920894a940b354d3c867079efada13d96cf9138712c76c8dea58fabd9c7e96f

<span class="token comment"># 启动了linux就卡主了，docker stats 查看cpu状态</span>

<span class="token comment"># 测试一下es成功了</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># curl localhost:9200</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;a920894a940b&quot;</span>,
  <span class="token string">&quot;cluster_name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;docker-cluster&quot;</span>,
  <span class="token string">&quot;cluster_uuid&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;bxE1TJMEThKgwmk7Aa3fHQ&quot;</span>,
  <span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;number&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;7.6.2&quot;</span>,
    <span class="token string">&quot;build_flavor&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
    <span class="token string">&quot;build_type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;docker&quot;</span>,
    <span class="token string">&quot;build_hash&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;</span>,
    <span class="token string">&quot;build_date&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2020-03-26T06:34:37.794943Z&quot;</span>,
    <span class="token string">&quot;build_snapshot&quot;</span> <span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;lucene_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;8.4.0&quot;</span>,
    <span class="token string">&quot;minimum_wire_compatibility_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;6.8.0&quot;</span>,
    <span class="token string">&quot;minimum_index_compatibility_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;6.0.0-beta1&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;tagline&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;You Know, for Search&quot;</span>
<span class="token punctuation">}</span>


<span class="token comment"># 增加内存限制，修改配置文件 -e 环境配置修改</span>
<span class="token function">docker</span> run -d --name elasticsearch -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 -e <span class="token string">&quot;discovery.type=single-node&quot;</span> -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms64m -Xmx512m&quot;</span> elasticsearch:7.6.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="可视化"><a href="#可视化" class="header-anchor">#</a> 可视化</h2> <ul><li>portainer</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8088</span>:9000 --restart<span class="token operator">=</span>always -v /var/run/docker.sock:/var/run/docker.sock --privileged<span class="token operator">=</span>true portainer/portainer
<span class="token comment"># 测试</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># curl localhost:8088</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span><span class="token operator">&lt;</span>html <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">&quot;en&quot;</span> ng-app<span class="token operator">=</span><span class="token string">&quot;portainer&quot;</span><span class="token operator">&gt;</span>
<span class="token comment"># 外网访问 http://ip:8088</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200812143512159.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70" alt="img"></p> <ul><li>Rancher(CI/CD再用)</li></ul> <h1 id="容器数据卷"><a href="#容器数据卷" class="header-anchor">#</a> 容器数据卷</h1> <h2 id="docker的理解回顾"><a href="#docker的理解回顾" class="header-anchor">#</a> Docker的理解回顾</h2> <p>数据？如果数据都在容器中，那么我们容器删除，数据就会丢失！<code>需求：数据可以持久化</code></p> <p>MySQL，容器删了，删库跑路！<code>需求：MySQL数据可以存储在本地！</code></p> <p>容器之间可以有一个数据共享技术！Docker容器中产生的数据，同步到本地！</p> <p>这就是卷技术，目录的挂载，将我们容器内的目录挂载到Linux目录上面！</p> <p><strong>总结：</strong> 容器的持久化和同步操作！容器间数据也是可以共享的！</p> <h2 id="使用数据卷"><a href="#使用数据卷" class="header-anchor">#</a> 使用数据卷</h2> <p>直接使用命令来挂载 -v</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 匿名挂载和具名挂载的目录都默认在/var/lib/docker/volumn目录下</span>
<span class="token number">1</span>. <span class="token function">docker</span> run -it -v 容器目录   <span class="token comment"># 匿名挂载</span>
<span class="token number">2</span>. <span class="token function">docker</span> run -it -v 卷名:容器目录  <span class="token comment"># 匿名挂载</span>
<span class="token number">3</span>. <span class="token function">docker</span> run -it -v 主机目录:容器目录 <span class="token comment"># 指定路径挂载</span>

<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home/ceshi:/home centos /bin/bash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200812165141715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p><strong>测试文件的同步</strong>（在主机上改动，观察容器变化）</p> <p><img src="https://img-blog.csdnimg.cn/2020081216585980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p><strong>注意：设置容器数据卷挂载后，容器目录和挂载的主机目录保持实时同步！</strong></p> <h2 id="实战-安装mysql"><a href="#实战-安装mysql" class="header-anchor">#</a> 实战：安装MySQL</h2> <p>思考：MySQL的数据持久化的问题！</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 获取镜像</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker pull mysql:5.7</span>

<span class="token comment"># 运行容器， 需要做数据挂载！ </span>
<span class="token comment"># 安装启动mysql，需要配置密码（注意）</span>
<span class="token comment"># 官方测试， docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span>

<span class="token comment"># 启动我们的</span>
-d		<span class="token comment"># 后台运行</span>
-p		<span class="token comment"># 端口映射</span>
-v		<span class="token comment"># 卷挂载</span>
-e		<span class="token comment"># 环境配置</span>
--name	<span class="token comment"># 容器的名字</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 3344:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span>
9552bf4eb2b69a2ccd344b5ba5965da4d97b19f2e1a78626ac1f2f8d276fc2ba

<span class="token comment"># 启动成功之后，我们在本地使用navicat链接测试一下</span>
<span class="token comment"># navicat链接到服务器的3344 --- 3344 和 容器的3306映射，这个时候我们就可以连接上mysql喽！</span>

<span class="token comment"># 在本地测试创建一个数据库，查看下我们的路径是否ok！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200812174632321.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h2 id="匿名和具名挂载-容器卷"><a href="#匿名和具名挂载-容器卷" class="header-anchor">#</a> 匿名和具名挂载（容器卷）</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 匿名挂载</span>
-v 容器内路径
<span class="token function">docker</span> run -d -P --name nginx01 -v /etc/nginx nginx		<span class="token comment"># -P 随机指定端口</span>

<span class="token comment"># 查看所有volume的情况</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER              VOLUME NAME
<span class="token builtin class-name">local</span>               561b81a03506f31d45ada3f9fb7bd8d7c9b5e0f826c877221a17e45d4c80e096
<span class="token builtin class-name">local</span>               36083fb6ca083005094cbd49572a0bffeec6daadfbc5ce772909bb00be760882

<span class="token comment"># 这里发现，这种情况就是匿名挂载，我们在-v 后面只写了容器内的路径，没有写容器外的路径！</span>

<span class="token comment"># 具名挂载</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span>
26da1ec7d4994c76e80134d24d82403a254a4e1d84ec65d5f286000105c3da17
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES
26da1ec7d499        nginx               <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">3</span> seconds ago       Up <span class="token number">2</span> seconds        <span class="token number">0.0</span>.0.0:32769-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx02
486de1da03cb        nginx               <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">3</span> minutes ago       Up <span class="token number">3</span> minutes        <span class="token number">0.0</span>.0.0:32768-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx01
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER              VOLUME NAME
<span class="token builtin class-name">local</span>               561b81a03506f31d45ada3f9fb7bd8d7c9b5e0f826c877221a17e45d4c80e096
<span class="token builtin class-name">local</span>               36083fb6ca083005094cbd49572a0bffeec6daadfbc5ce772909bb00be760882
<span class="token builtin class-name">local</span>               juming-nginx

<span class="token comment"># 通过 -v 卷名:容器内的路径</span>
<span class="token comment"># 查看一下这个卷</span>
<span class="token comment"># docker volume inspect juming-nginx</span>

<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect juming-nginx</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
      <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-08-12T18:15:21+08:00&quot;</span>,
      <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
      <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> null,
      <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/juming-nginx/_data&quot;</span>,
      <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;juming-nginx&quot;</span>,
      <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> null,
      <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><strong>拓展</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 通过 -v 容器内路径[:ro|:rw] 改变读写权限 </span>
<span class="token comment"># ro readonly 只读	</span>
<span class="token comment"># rw readwrite 可读可写</span>
<span class="token function">docker</span> run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx
<span class="token function">docker</span> run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx
<span class="token comment"># ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内容无法操作</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h1 id="初始dockerfile"><a href="#初始dockerfile" class="header-anchor">#</a> 初始Dockerfile</h1> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 创建一个dockerfile文件， 名字可以随机</span>
<span class="token comment"># 文件的内容 指定（大写）参数</span>

FROM centos

<span class="token comment"># 匿名挂载</span>
VOLUME <span class="token punctuation">[</span><span class="token string">&quot;volume01&quot;</span>, <span class="token string">&quot;volume02&quot;</span><span class="token punctuation">]</span>

CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;----end----&quot;</span>
CMD /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200813102153118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p><strong>启动自己的容器</strong></p> <p><img src="https://img-blog.csdnimg.cn/20200813103117628.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p><strong>docker inspect 容器id</strong></p> <p><img src="https://img-blog.csdnimg.cn/20200813103859654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>假设构建镜像时候没有挂载卷，要手动镜像挂载 -v 卷名:容器内路径！</p> <h2 id="数据卷容器"><a href="#数据卷容器" class="header-anchor">#</a> 数据卷容器</h2> <p>多个mysql同步数据！</p> <p><img src="https://img-blog.csdnimg.cn/20200813115602683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 启动3个容器，通过我们刚才自己写的镜像启动</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200813120430844.png#pic_center" alt="img"></p> <p><img src="https://img-blog.csdnimg.cn/20200813121031935.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>多个mysql实现数据共享</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 3344:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 3344:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ home<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 3344:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql03 --volumes-from mysql01 mysql:5.7</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://cdn.nlark.com/yuque/0/2021/png/2651282/1636630506231-74ab3968-e944-48df-9139-17628cbbb32e.png" alt="img"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> inspect centos01
<span class="token punctuation">[</span><span class="token punctuation">{</span>
	<span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
	<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;7895bf2c2184d440f4be4c539313055ce35f70606728aad7bb73dd46cf4dcfca&quot;</span>,
	<span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/7895bf2c2184d440f4be4c539313055ce35f70606728aad7bb73dd46cf4dcfca/_data&quot;</span>,
	<span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume02&quot;</span>,
	<span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
	<span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
	<span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
	<span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>, <span class="token punctuation">{</span>
	<span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
	<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;27e5f3ac52359984ddb695cb2bd1c375fb218e8ff6257044294e78bb63af36f4&quot;</span>,
	<span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/27e5f3ac52359984ddb695cb2bd1c375fb218e8ff6257044294e78bb63af36f4/_data&quot;</span>,
	<span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume01&quot;</span>,
	<span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
	<span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
	<span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
	<span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token function">docker</span> inspect centos02 
<span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
	<span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
	<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;27e5f3ac52359984ddb695cb2bd1c375fb218e8ff6257044294e78bb63af36f4&quot;</span>,
	<span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/27e5f3ac52359984ddb695cb2bd1c375fb218e8ff6257044294e78bb63af36f4/_data&quot;</span>,
	<span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume01&quot;</span>,
	<span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
	<span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
	<span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
	<span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>, <span class="token punctuation">{</span>
	<span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
	<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;7895bf2c2184d440f4be4c539313055ce35f70606728aad7bb73dd46cf4dcfca&quot;</span>,
	<span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/7895bf2c2184d440f4be4c539313055ce35f70606728aad7bb73dd46cf4dcfca/_data&quot;</span>,
	<span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume02&quot;</span>,
	<span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
	<span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
	<span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
	<span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token function">docker</span> inspect centos03 
<span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
	<span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
	<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;7895bf2c2184d440f4be4c539313055ce35f70606728aad7bb73dd46cf4dcfca&quot;</span>,
	<span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/7895bf2c2184d440f4be4c539313055ce35f70606728aad7bb73dd46cf4dcfca/_data&quot;</span>,
	<span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume02&quot;</span>,
	<span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
	<span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
	<span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
	<span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>, <span class="token punctuation">{</span>
	<span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
	<span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;27e5f3ac52359984ddb695cb2bd1c375fb218e8ff6257044294e78bb63af36f4&quot;</span>,
	<span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/27e5f3ac52359984ddb695cb2bd1c375fb218e8ff6257044294e78bb63af36f4/_data&quot;</span>,
	<span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume01&quot;</span>,
	<span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
	<span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
	<span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
	<span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p><strong>通过查看centos01、02、03的数据卷挂载情况，可以发现，数据卷容器的实现原理其实就是把其他继承数据卷容器的数据卷映射到相同的外部挂载点，这样这个外部挂载点有目录文件变更，就会同步到数据卷容器以及其他继承关系的容器中</strong></p> <h2 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> DockerFile</h2> <h2 id="dockerfile的构建过程"><a href="#dockerfile的构建过程" class="header-anchor">#</a> DockerFile的构建过程</h2> <p><strong>基础知识：</strong></p> <ol><li><p>每个保留关键字（指令）都是必须大写字母</p></li> <li><p>执行从上到下顺序执行</p></li> <li><p><code>#</code> 表示注释</p></li> <li><p>每个指令都会创建提交一个新的镜像层，并提交！</p></li></ol> <p><img src="https://img-blog.csdnimg.cn/20200813142333870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>dockerFile是面向开发的， 我们以后要发布项目， 做镜像， 就需要编写dockefile文件， 这个文件十分简单！</p> <h2 id="dockerfile指令说明"><a href="#dockerfile指令说明" class="header-anchor">#</a> DockerFile指令说明</h2> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/2651282/1636631425891-b81d4b54-03fd-4ee1-ace0-7d900351dc54.png" alt="img"></p> <h2 id="创建一个自己的centos"><a href="#创建一个自己的centos" class="header-anchor">#</a> 创建一个自己的Centos</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 1. 编写Dockerfile的文件</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># cat mydockerfile-centos </span>
FROM centos
MAINTAINER xiaofan<span class="token operator">&lt;</span><span class="token number">594042358</span>@qq.com<span class="token operator">&gt;</span>

ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>		<span class="token comment"># 镜像的工作目录</span>

RUN yum -y <span class="token function">install</span> <span class="token function">vim</span> <span class="token punctuation">\</span>
	<span class="token operator">&amp;&amp;</span> yum -y <span class="token function">install</span> net-tools

EXPOSE <span class="token number">80</span>

CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;---end---&quot;</span>
CMD /bin/bash

<span class="token comment"># 2. 通过这个文件构建镜像</span>
<span class="token comment"># 命令 docker build -f &lt;Dockerfile文件路径&gt; -t 镜像名:[tag] &lt;构建上下文路径&gt;</span>

<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker build -f mydockerfile-centos -t mycentos:0.1 .</span>

Successfully built d2d9f0ea8cb2
Successfully tagged mycentos:0.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200813152240210.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>我们可以列出本地进行的变更历史</p> <p><img src="https://img-blog.csdnimg.cn/20200813152814641.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h3 id="cmd-和entrypoint区别"><a href="#cmd-和entrypoint区别" class="header-anchor">#</a> CMD 和ENTRYPOINT区别</h3> <p>CMD</p> <ul><li>指定这个容器启动的时候要运行的命令</li> <li>当同时存在ENTRYPOINT时，会被当作ENTRYPOINT声明command的参数（可变参数）</li> <li>会被docker run 后指定的command覆盖</li></ul> <p>ENTRYPOINT</p> <ul><li>指定这个容器启动的时候要运行的命令</li> <li>当同时存在CMD时，会把CMD声明command当作参数（可变参数）</li> <li>会被docker run --entrypoint 后指定的command覆盖</li></ul> <h4 id="只包含cmd"><a href="#只包含cmd" class="header-anchor">#</a> 只包含CMD</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># cat dockfile</span>
FROM centos
CMD <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span>, <span class="token string">&quot;-a&quot;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker build -f dockerfile -t centos:v1 .</span>

<span class="token comment"># 3. run运行， 发现我们的ls -a 命令生效</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run ebe6a52bb125</span>
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev
etc
home
lib
lib64

<span class="token comment"># 想追加一个命令 -l 变成 ls -al</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run ebe6a52bb125 -l</span>
docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused <span class="token string">&quot;exec: <span class="token entity" title="\&quot;">\&quot;</span>-l<span class="token entity" title="\&quot;">\&quot;</span>: executable file not found in <span class="token environment constant">$PATH</span>&quot;</span><span class="token builtin class-name">:</span> unknown.
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run ebe6a52bb125 ls -l</span>

<span class="token comment"># cmd的情况下 -l替换了CMD[&quot;ls&quot;, &quot;-a&quot;]命令， -l不是命令，所以报错了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="只包含entrypoint"><a href="#只包含entrypoint" class="header-anchor">#</a> 只包含ENTRYPOINT</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># cat dockerfile </span>
FROM centos
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span>, <span class="token string">&quot;-a&quot;</span><span class="token punctuation">]</span>


<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker build -f dockerfile -t centos:v1 .</span>

<span class="token comment"># 3. run运行 发现我们的ls -a 命令同样生效</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run centos:v1</span>
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev
etc
home
lib

<span class="token comment"># 4. 我们的追加命令， 是直接拼接到ENTRYPOINT命令的后面的！</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run centos:v1 -l</span>
total <span class="token number">56</span>
drwxr-xr-x  <span class="token number">1</span> root root <span class="token number">4096</span> Aug <span class="token number">13</span> 07:52 <span class="token builtin class-name">.</span>
drwxr-xr-x  <span class="token number">1</span> root root <span class="token number">4096</span> Aug <span class="token number">13</span> 07:52 <span class="token punctuation">..</span>
-rwxr-xr-x  <span class="token number">1</span> root root    <span class="token number">0</span> Aug <span class="token number">13</span> 07:52 .dockerenv
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">7</span> May <span class="token number">11</span>  <span class="token number">2019</span> bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x  <span class="token number">5</span> root root  <span class="token number">340</span> Aug <span class="token number">13</span> 07:52 dev
drwxr-xr-x  <span class="token number">1</span> root root <span class="token number">4096</span> Aug <span class="token number">13</span> 07:52 etc
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> May <span class="token number">11</span>  <span class="token number">2019</span> home
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">7</span> May <span class="token number">11</span>  <span class="token number">2019</span> lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx  <span class="token number">1</span> root root    <span class="token number">9</span> May <span class="token number">11</span>  <span class="token number">2019</span> lib64 -<span class="token operator">&gt;</span> usr/lib64
drwx------  <span class="token number">2</span> root root <span class="token number">4096</span> Aug  <span class="token number">9</span> <span class="token number">21</span>:40 lost+found
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="同时包含cmd和entrypoint"><a href="#同时包含cmd和entrypoint" class="header-anchor">#</a> 同时包含CMD和ENTRYPOINT</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># cat dockerfile </span>
FROM centos:latest
MAINTAINER ZHAOXING<span class="token operator">&lt;</span><span class="token number">779292642</span>@qq.com<span class="token operator">&gt;</span>

ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>

CMD <span class="token punctuation">[</span><span class="token string">&quot;-a&quot;</span><span class="token punctuation">]</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker build -f dockerfile -t centos:v1 .</span>

<span class="token comment"># 执行命令：ls -a</span>
<span class="token comment"># CMD声明的command会当作ENTRYPOINT声明的command的参数</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run centos:v1</span>
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
bin
etc
games
include
lib
lib64
libexec
sbin
share
src

<span class="token comment"># 覆盖CMD声明的command</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run centos:v1 -l</span>
total <span class="token number">0</span>
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> bin
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> etc
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> games
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> include
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> lib
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">16</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 lib64
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> libexec
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> sbin
drwxr-xr-x. <span class="token number">5</span> root root <span class="token number">46</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 share
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> src
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run centos:v1 -al</span>
total <span class="token number">8</span>
drwxr-xr-x. <span class="token number">12</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 <span class="token builtin class-name">.</span>
drwxr-xr-x. <span class="token number">12</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 <span class="token punctuation">..</span>
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> bin
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> etc
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> games
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> include
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> lib
drwxr-xr-x.  <span class="token number">3</span> root root   <span class="token number">16</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 lib64
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> libexec
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> sbin
drwxr-xr-x.  <span class="token number">5</span> root root   <span class="token number">46</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 share
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> src


<span class="token comment"># 覆盖ENTRYPOINT声明的command（此时CMD声明的command失效）</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run --entrypoint ls 3a</span>
bin
etc
games
include
lib
lib64
libexec
sbin
share
src

<span class="token comment"># 同时覆盖ENTRYPOINT和CMD声明的command</span>
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run --entrypoint ls 3a -a</span>
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
bin
etc
games
include
lib
lib64
libexec
sbin
share
src
<span class="token punctuation">[</span>root@localhost dockfile<span class="token punctuation">]</span><span class="token comment"># docker run --entrypoint ls 3a -al</span>
total <span class="token number">8</span>
drwxr-xr-x. <span class="token number">12</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 <span class="token builtin class-name">.</span>
drwxr-xr-x. <span class="token number">12</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 <span class="token punctuation">..</span>
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> bin
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> etc
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> games
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> include
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> lib
drwxr-xr-x.  <span class="token number">3</span> root root   <span class="token number">16</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 lib64
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> libexec
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> sbin
drwxr-xr-x.  <span class="token number">5</span> root root   <span class="token number">46</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 share
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> src
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><h1 id="dockerfile制作tomcat镜像"><a href="#dockerfile制作tomcat镜像" class="header-anchor">#</a> Dockerfile制作Tomcat镜像</h1> <h2 id="制作tomcat镜像"><a href="#制作tomcat镜像" class="header-anchor">#</a> 制作Tomcat镜像</h2> <ol><li>准备镜像文件 tomcat压缩包，jdk的压缩包！</li></ol> <p><img src="https://img-blog.csdnimg.cn/20200813164403261.png" alt="img"></p> <ol start="2"><li>编写Dockerfile文件, build默认在构建上下文寻找名称为Dockfile的文件，就不需要-f 指定了！</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ tomcat<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM centos
MAINTAINER xiaofan<span class="token operator">&lt;</span><span class="token number">594042358</span>@qq.com<span class="token operator">&gt;</span>
COPY readme.txt /usr/local/readme.txt
<span class="token comment"># ADD 会自动解压</span>
ADD jdk-8u73-linux-x64.tar.gz /usr/local/
ADD apache-tomcat-9.0.37.tar.gz /usr/local/
RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>
ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>
ENV JAVA_HOME /usr/local/jdk1.8.0_73
ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar
ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.37
ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.37
ENV <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/lib:<span class="token variable">$CATALINA_HOME</span>/bin
EXPOSE <span class="token number">8080</span>
CMD /usr/local/apache-tomcat-9.0.37/bin/startup.sh <span class="token operator">&amp;&amp;</span> <span class="token function">tail</span> -F /usr/local/apache-tomcat-9.0.37/bin/logs/catalina.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="3"><li>构建镜像</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># docker build -t diytomcat .</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="4"><li>启动镜像</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">3344</span>:8080 <span class="token punctuation">\</span>
--name xiaofantomcat1 <span class="token punctuation">\</span>
-v /home/xiaofan/build/tomcat/test:/usr/local/apache-tomcat-9.0.37/webapps/test <span class="token punctuation">\</span>
-v /home/xiaofan/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.37/logs 
diytomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="5"><li>访问测试</li></ol> <p>​	在本地编写web.xml和index.jsp进行测试</p> <p><img src="https://img-blog.csdnimg.cn/20200813180242294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>web-app <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&quot;2.4&quot;</span> 
    <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span> 
    xmlns:xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    xsi:schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://java.sun.com/xml/ns/j2ee 
        http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span><span class="token operator">&gt;</span>
        
<span class="token operator">&lt;</span>/web-app<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">&lt;</span>%@ page <span class="token assign-left variable">language</span><span class="token operator">=</span><span class="token string">&quot;java&quot;</span> <span class="token assign-left variable">contentType</span><span class="token operator">=</span><span class="token string">&quot;text/html; charset=UTF-8&quot;</span>
    <span class="token assign-left variable">pageEncoding</span><span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span>%<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>hello. xiaofan<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
Hello World<span class="token operator">!</span><span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>%
System.out.println<span class="token punctuation">(</span><span class="token string">&quot;-----my test web logs------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
%<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>发现：项目部署成功， 可以直接访问ok！</p> <p><img src="https://img-blog.csdnimg.cn/20200813175909845.png#pic_center" alt="img"></p> <h2 id="发布自己的镜像到docker-hub"><a href="#发布自己的镜像到docker-hub" class="header-anchor">#</a> 发布自己的镜像到Docker Hub</h2> <ol><li><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Dockker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 注册自己的账号！
<img src="https://img-blog.csdnimg.cn/20200813182851607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></li> <li>确定这个账号可以登录</li></ol> <p><img src="https://img-blog.csdnimg.cn/20200813183151439.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <ol start="3"><li>在我们的服务器上提交自己的镜像</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># push到我们的服务器上</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker push diytomcat</span>
The push refers to repository <span class="token punctuation">[</span>docker.io/library/diytomcat<span class="token punctuation">]</span>
2eaca873a720: Preparing 
1b38cc4085a8: Preparing 
088ebb58d264: Preparing 
c06785a2723d: Preparing 
291f6e44771a: Preparing 
denied: requested access to the resource is denied	<span class="token comment"># 拒绝</span>

<span class="token comment"># push镜像的问题？</span>
The push refers to repository <span class="token punctuation">[</span>docker.io/1314520007/diytomcat<span class="token punctuation">]</span>
An image does not exist locally with the tag: <span class="token number">1314520007</span>/diytomcat

<span class="token comment"># 解决，增加一个tag</span>
<span class="token function">docker</span> tag diytomcat <span class="token number">1314520007</span>/tomcat:1.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200813184137474.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h2 id="发布到阿里云镜像服务上"><a href="#发布到阿里云镜像服务上" class="header-anchor">#</a> 发布到阿里云镜像服务上</h2> <ol><li><p>登录阿里云</p></li> <li><p>找到容器镜像服务</p></li> <li><p>创建命名空间</p></li></ol> <p><img src="https://img-blog.csdnimg.cn/20200813190111625.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <ol start="4"><li>创建镜像仓库</li></ol> <p><img src="https://img-blog.csdnimg.cn/20200813190303741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <ol start="5"><li>点击仓库名称，参考官方文档即可</li></ol> <p><img src="https://img-blog.csdnimg.cn/20200813191526549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p><img src="https://img-blog.csdnimg.cn/20200813194116511.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h1 id="docker网络"><a href="#docker网络" class="header-anchor">#</a> Docker网络</h1> <h2 id="连接-docker0"><a href="#连接-docker0" class="header-anchor">#</a> 连接 Docker0</h2> <p><strong>测试</strong></p> <p><img src="https://img-blog.csdnimg.cn/20200814091723905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p><strong>三个网络</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 问题： docker是如何处理容器网络访问的？</span>

<span class="token comment"># [root@iZ2zeg4ytp0whqtmxbsqiiZ ~]# docker run -d -P --name tomcat01 tomcat</span>

<span class="token comment"># 查看容器内部的网络地址 ip addr</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat01 ip addr， 发现容器启动的时候得到一个eth0@if115 ip地址，docker分配的！</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">114</span>: eth0@if115: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever

<span class="token comment"># 思考： linux 能不能ping通容器？</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># ping 172.17.0.2</span>
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.077</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.069</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.075</span> ms

<span class="token comment"># linux 可以 ping 通docker容器内部！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>原理</strong></p> <blockquote><p>我们每启动一个docker容器， docker就会给docker容器分配一个ip， 我们只要安装了docker，就会有一个网卡 docker0桥接模式，使用的技术是veth-pair技术！</p></blockquote> <p>再次测试 ip addr</p> <p><img src="https://img-blog.csdnimg.cn/20200814092954929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>再启动一个容器测试， 发现又多了一对网卡</p> <p><img src="https://img-blog.csdnimg.cn/20200814093432884.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 我们发现这个容器带来网卡，都是一对对的</span>
<span class="token comment"># veth-pair 就是一对的虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连</span>
<span class="token comment"># 正因为有这个特性，veth-pair充当一个桥梁， 连接各种虚拟网络设备</span>
<span class="token comment"># OpenStac， Docker容器之间的链接，OVS的链接， 都是使用veth-pair技术</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们测试一下tomcat01和tomcat02之间是否可以ping通！
<img src="https://img-blog.csdnimg.cn/2020081409492726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>结论：容器与容器之间是可以相互ping通的！</p> <p>绘制一个网络模型图</p> <p><img src="https://img-blog.csdnimg.cn/20200814101617604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>结论：tomcat01和tomcat02是共用的一个路由器，docker0</p> <p>所有容器不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用IP</p> <p>小结</p> <p>Docker使用的是Linux的桥接，宿主机中是一个Docker容器的网桥docker0.</p> <p><img src="https://img-blog.csdnimg.cn/20200814102155735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>Docker中的所有的网络接口都是虚拟的，虚拟的转发效率高！（内网传递文件！）</p> <p>只要容器删除，对应的网桥一对就没有了！</p> <p><img src="https://img-blog.csdnimg.cn/20200814103808900.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h2 id="link"><a href="#link" class="header-anchor">#</a> -- link</h2> <p><strong>解决通过docker0联通时通过容器名访问</strong></p> <p>思考一个场景，我们编写了一个微服务，database url =ip； 项目不重启，数据ip换掉了，我们希望可以处理这个问题，可以按名字来进行访问容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat02 ping tomcat01</span>
ping: tomcat01: Name or <span class="token function">service</span> not known

<span class="token comment"># 如何可以解决呢？</span>
<span class="token comment"># 通过--link即可以解决网络连通问题</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P  --name tomcat03 --link tomcat02 tomcat</span>
3a2bcaba804c5980d94d168457c436fbd139820be2ee77246888f1744e6bb473
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES
3a2bcaba804c        tomcat              <span class="token string">&quot;catalina.sh run&quot;</span>   <span class="token number">4</span> seconds ago       Up <span class="token number">3</span> seconds        <span class="token number">0.0</span>.0.0:32772-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   tomcat03
f22ed47ed1be        tomcat              <span class="token string">&quot;catalina.sh run&quot;</span>   <span class="token number">57</span> minutes ago      Up <span class="token number">57</span> minutes       <span class="token number">0.0</span>.0.0:32771-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   tomcat02
9d97f93401a0        tomcat              <span class="token string">&quot;catalina.sh run&quot;</span>   About an hour ago   Up About an hour    <span class="token number">0.0</span>.0.0:32770-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   tomcat01
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat03 ping tomcat02</span>
PING tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.129</span> ms
<span class="token number">64</span> bytes from tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.100</span> ms
<span class="token number">64</span> bytes from tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.110</span> ms
<span class="token number">64</span> bytes from tomcat02 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.107</span> ms

<span class="token comment"># 反向可以ping通吗？</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat02 ping tomcat03</span>
ping: tomcat03: Name or <span class="token function">service</span> not known
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>探究：inspect！</p> <p><img src="https://img-blog.csdnimg.cn/20200814104403761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>其实这个tomcat03就是在本地配置了tomcat02的配置？</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat03 cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1	localhost
::1	localhost ip6-localhost ip6-loopback
fe00::0	ip6-localnet
ff00::0	ip6-mcastprefix
ff02::1	ip6-allnodes
ff02::2	ip6-allrouters
<span class="token number">172.17</span>.0.3	tomcat02 f22ed47ed1be
<span class="token number">172.17</span>.0.4	3a2bcaba804c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>本质探究：--link 就是我们在hosts配置中增加了一个172.17.0.3	tomcat02 f22ed47ed1be</p> <p>我们现在玩Docker已经不建议使用--link了！</p> <p>自定义网络！不使用Docker0！</p> <p>Docker0的问题：它不支持容器名链接访问！</p> <h2 id="自定义网络"><a href="#自定义网络" class="header-anchor">#</a> 自定义网络</h2> <p>查看所有的docker网络</p> <p><img src="https://img-blog.csdnimg.cn/20200814105640929.png#pic_center" alt="img"></p> <p><strong>网络模式</strong></p> <ul><li><p>bridge： 桥接模式，桥接 docker 默认，自己创建的也是用brdge模式</p></li> <li><p>none： 不配置网络</p></li> <li><p>host： 和宿主机共享网络</p></li> <li><p>container：容器网络连通！（用的少， 局限很大）</p></li></ul> <p><strong>测试</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 我们直接启动的命令默认有一个 --net bridge，而这个就是我们的docker0</span>
<span class="token function">docker</span> run -d -P --name tomcat01 tomcat
<span class="token function">docker</span> run -d -P --name tomcat01 --net bridge tomcat

<span class="token comment"># docker0特点，默认，容器名不能访问， --link可以打通连接！</span>
<span class="token comment"># 我们可以自定义一个网络！</span>
<span class="token comment"># --driver bridge</span>
<span class="token comment"># --subnet 192.168.0.0/16 可以支持255*255个网络 192.168.0.2 ~ 192.168.255.254</span>
<span class="token comment"># --gateway 192.168.0.1</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span>
26a5afdf4805d7ee0a660b82244929a4226470d99a179355558dca35a2b983ec
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
30d601788862        bridge              bridge              <span class="token builtin class-name">local</span>
226019b14d91        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
26a5afdf4805        mynet               bridge              <span class="token builtin class-name">local</span>
7496c014f74b        none                null                <span class="token builtin class-name">local</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>我们自己创建的网络就ok了！</p> <p><img src="https://img-blog.csdnimg.cn/20200814112009570.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>在自己创建的网络里面启动两个容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name tomcat-net-01 --net mynet tomcat</span>
0e85ebe6279fd23379d39b27b5f47c1e18f23ba7838637802973bf6449e22f5c
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name tomcat-net-02 --net mynet tomcat</span>
c6e462809ccdcebb51a4078b1ac8fdec33f1112e9e416406b606d0c9fb6f21b5
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect mynet</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mynet&quot;</span>,
        <span class="token string">&quot;Id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;26a5afdf4805d7ee0a660b82244929a4226470d99a179355558dca35a2b983ec&quot;</span>,
        <span class="token string">&quot;Created&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2020-08-14T11:12:40.553433163+08:00&quot;</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,
        <span class="token string">&quot;EnableIPv6&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;IPAM&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
            <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.0/16&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.1&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Internal&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Attachable&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Ingress&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;ConfigFrom&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;ConfigOnly&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;0e85ebe6279fd23379d39b27b5f47c1e18f23ba7838637802973bf6449e22f5c&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tomcat-net-01&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;576ce5c0f5860a5aab5e487a805da9d72f41a409c460f983c0bd341dd75d83ac&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:00:02&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.2/16&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;c6e462809ccdcebb51a4078b1ac8fdec33f1112e9e416406b606d0c9fb6f21b5&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tomcat-net-02&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;81ecbc4fe26e49855fe374f2d7c00d517b11107cc91a174d383ff6be37d25a30&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:00:03&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.3/16&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># 再次ping连接</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat-net-01 ping 192.168.0.3</span>
PING <span class="token number">192.168</span>.0.3 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.3: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.113</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.3: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.093</span> ms
^C
--- <span class="token number">192.168</span>.0.3 <span class="token function">ping</span> statistics ---
<span class="token number">2</span> packets transmitted, <span class="token number">2</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 999ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.093</span>/0.103/0.113/0.010 ms
<span class="token comment"># 现在不使用 --link也可以ping名字了！</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat-net-01 ping tomcat-net-02</span>
PING tomcat-net-02 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.068</span> ms
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.096</span> ms
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.094</span> ms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>我们自定义的网络docker都已经帮我们维护好了对应的关系，推荐我们平时这样使用网络</p> <p>好处：</p> <blockquote><p>redis - 不同的集群使用不同的网络，保证集群是安全和健康的</p> <p>mysql - 不同的集群使用不同的网络，保证集群是安全和健康的</p></blockquote> <h2 id="网络连通-不同网络之间"><a href="#网络连通-不同网络之间" class="header-anchor">#</a> 网络连通（不同网络之间）</h2> <p><img src="https://img-blog.csdnimg.cn/20200814114621170.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p>测试打通tomcat01 和mynet</p> <p><img src="https://img-blog.csdnimg.cn/2020081411482318.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker network connect  mynet tomcat01</span>

<span class="token comment"># 连通之后就是讲tomcat01放到了mynet网络下</span>
<span class="token comment"># 一个容器两个ip地址：</span>
<span class="token comment"># 阿里云服务器，公网ip，私网ip</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200814115317846.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p><img src="https://img-blog.csdnimg.cn/20200814115404720.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 连通ok</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat01 ping tomcat-net-01</span>
PING tomcat-net-01 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.100</span> ms
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.085</span> ms
^C
--- tomcat-net-01 <span class="token function">ping</span> statistics ---
<span class="token number">2</span> packets transmitted, <span class="token number">2</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 1000ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.085</span>/0.092/0.100/0.012 ms
<span class="token comment"># 依旧无法连通，没有connect</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it tomcat02 ping tomcat-net-01</span>
ping: tomcat-net-01: Name or <span class="token function">service</span> not known
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>结论：假设要跨网络操作别人，就要使用docker network connect连通.....!</p> <h2 id="实战-部署redis"><a href="#实战-部署redis" class="header-anchor">#</a> 实战：部署redis</h2> <p><img src="https://img-blog.csdnimg.cn/20200814124440671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h3 id="实战一-bridge网络-docker"><a href="#实战一-bridge网络-docker" class="header-anchor">#</a> 实战一（bridge网络 + docker）</h3> <blockquote><p>这种方案 spring boot 项目连接redis集群时有问题：redis节点之间通信有问题，还是使用的自定义网段分配的地址</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 创建网卡</span>
<span class="token function">docker</span> network create redis --subnet <span class="token number">172.38</span>.0.0/16

<span class="token comment"># 通过脚本创建六个redis配置</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
<span class="token keyword">do</span> <span class="token punctuation">\</span>
<span class="token function">mkdir</span> -p /home/software/redis/node-<span class="token variable">${port}</span>/conf
<span class="token function">touch</span> /home/software/redis/node-<span class="token variable">${port}</span>/conf/redis.conf
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>/home/software/redis/node-<span class="token variable">${port}</span>/conf/redis.conf</span>
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1<span class="token variable">${port}</span>
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF</span>
<span class="token keyword">done</span>
<span class="token comment"># 创建结点1</span>
<span class="token function">docker</span> run -p <span class="token number">6371</span>:6379 -p <span class="token number">16371</span>:16379 --name redis-1 <span class="token punctuation">\</span>
-v /home/software/redis/node-1/data:/data <span class="token punctuation">\</span>
-v /home/software/redis/node-1/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redis --ip <span class="token number">172.38</span>.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token comment">#创建结点2</span>
<span class="token function">docker</span> run -p <span class="token number">6372</span>:6379 -p <span class="token number">16372</span>:16379 --name redis-2 <span class="token punctuation">\</span>
-v /home/software/redis/node-2/data:/data <span class="token punctuation">\</span>
-v /home/software/redis/node-2/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redis --ip <span class="token number">172.38</span>.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
<span class="token comment">#创建结点3</span>
<span class="token function">docker</span> run -p <span class="token number">6373</span>:6379 -p <span class="token number">16373</span>:16379 --name redis-3 <span class="token punctuation">\</span>
-v /home/software/redis/node-3/data:/data <span class="token punctuation">\</span>
-v /home/software/redis/node-3/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redis --ip <span class="token number">172.38</span>.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
<span class="token comment">#创建结点4</span>
<span class="token function">docker</span> run -p <span class="token number">6374</span>:6379 -p <span class="token number">16374</span>:16379 --name redis-4 <span class="token punctuation">\</span>
-v /home/software/redis/node-4/data:/data <span class="token punctuation">\</span>
-v /home/software/redis/node-4/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redis --ip <span class="token number">172.38</span>.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
<span class="token comment">#创建结点5</span>
<span class="token function">docker</span> run -p <span class="token number">6375</span>:6379 -p <span class="token number">16375</span>:16379 --name redis-5 <span class="token punctuation">\</span>
-v /home/software/redis/node-5/data:/data <span class="token punctuation">\</span>
-v /home/software/redis/node-5/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redis --ip <span class="token number">172.38</span>.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
<span class="token comment">#创建结点6</span>
<span class="token function">docker</span> run -p <span class="token number">6376</span>:6379 -p <span class="token number">16376</span>:16379 --name redis-6 <span class="token punctuation">\</span>
-v /home/software/redis/node-6/data:/data <span class="token punctuation">\</span>
-v /home/software/redis/node-6/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redis --ip <span class="token number">172.38</span>.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf

<span class="token comment"># 创建集群</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it redis-1 /bin/sh</span>
/data <span class="token comment"># ls</span>
appendonly.aof  nodes.conf
/data <span class="token comment"># redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">172.38</span>.0.15:6379 to <span class="token number">172.38</span>.0.11:6379
Adding replica <span class="token number">172.38</span>.0.16:6379 to <span class="token number">172.38</span>.0.12:6379
Adding replica <span class="token number">172.38</span>.0.14:6379 to <span class="token number">172.38</span>.0.13:6379
M: 541b7d237b641ac2ffc94d17c6ab96b18b26a638 <span class="token number">172.38</span>.0.11:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: a89c1f1245b264e4a402a3cf99766bcb6138dbca <span class="token number">172.38</span>.0.12:6379
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: 259e804d6df74e67a72e4206d7db691a300c775e <span class="token number">172.38</span>.0.13:6379
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: 9b19170eea3ea1b92c58ad18c0b5522633a9e271 <span class="token number">172.38</span>.0.14:6379
   replicates 259e804d6df74e67a72e4206d7db691a300c775e
S: 061a9d38f22910aaf0ba1dbd21bf1d8f57bcb7d5 <span class="token number">172.38</span>.0.15:6379
   replicates 541b7d237b641ac2ffc94d17c6ab96b18b26a638
S: 7a16b9bbb0615ec95fc978fa62fc054df60536f0 <span class="token number">172.38</span>.0.16:6379
   replicates a89c1f1245b264e4a402a3cf99766bcb6138dbca
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">'yes'</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">172.38</span>.0.11:6379<span class="token punctuation">)</span>
M: 541b7d237b641ac2ffc94d17c6ab96b18b26a638 <span class="token number">172.38</span>.0.11:6379
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: a89c1f1245b264e4a402a3cf99766bcb6138dbca <span class="token number">172.38</span>.0.12:6379
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 7a16b9bbb0615ec95fc978fa62fc054df60536f0 <span class="token number">172.38</span>.0.16:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates a89c1f1245b264e4a402a3cf99766bcb6138dbca
S: 061a9d38f22910aaf0ba1dbd21bf1d8f57bcb7d5 <span class="token number">172.38</span>.0.15:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 541b7d237b641ac2ffc94d17c6ab96b18b26a638
M: 259e804d6df74e67a72e4206d7db691a300c775e <span class="token number">172.38</span>.0.13:6379
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 9b19170eea3ea1b92c58ad18c0b5522633a9e271 <span class="token number">172.38</span>.0.14:6379
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 259e804d6df74e67a72e4206d7db691a300c775e
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div><h3 id="实战二-host网络-docker-compose"><a href="#实战二-host网络-docker-compose" class="header-anchor">#</a> 实战二（host网络 + docker-compose）</h3> <p>docker搭建redis集群完成！</p> <p><img src="https://img-blog.csdnimg.cn/20200814140307648.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h2 id="springboot微服务打包docker镜像"><a href="#springboot微服务打包docker镜像" class="header-anchor">#</a> SpringBoot微服务打包Docker镜像</h2> <ul><li>打包应用</li> <li>编写Dockerfile</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>FROM java:8

COPY *.jar /app.jar

CMD <span class="token punctuation">[</span><span class="token string">&quot;--server.port=8080&quot;</span><span class="token punctuation">]</span>

EXPOSE <span class="token number">8080</span>

ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;-jar&quot;</span>, <span class="token string">&quot;/app.jar&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>构建镜像</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 上传jar包和Dockerfile到Linux</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ idea<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">16140</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">16519871</span> Aug <span class="token number">14</span> <span class="token number">17</span>:38 demo-0.0.1-SNAPSHOT.jar
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">122</span> Aug <span class="token number">14</span> <span class="token number">17</span>:38 Dockerfile

<span class="token comment"># 构建镜像</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ idea<span class="token punctuation">]</span><span class="token comment"># docker build -t myapp:V1 .</span>
Sending build context to Docker daemon  <span class="token number">16</span>.52MB
Step <span class="token number">1</span>/5 <span class="token builtin class-name">:</span> FROM java:8
<span class="token number">8</span>: Pulling from library/java
5040bd298390: Pull complete 
fce5728aad85: Pull complete 
76610ec20bf5: Pull complete 
60170fec2151: Pull complete 
e98f73de8f0d: Pull complete 
11f7af24ed9c: Pull complete 
49e2d6393f32: Pull complete 
bb9cdec9c7f3: Pull complete 
Digest: sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d
Status: Downloaded newer image <span class="token keyword">for</span> java:8
 ---<span class="token operator">&gt;</span> d23bdf5b1b1b
Step <span class="token number">2</span>/5 <span class="token builtin class-name">:</span> COPY *.jar /app.jar
 ---<span class="token operator">&gt;</span> d4de8837ebf9
Step <span class="token number">3</span>/5 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;--server.port=8080&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> e3abc66303f0
Removing intermediate container e3abc66303f0
 ---<span class="token operator">&gt;</span> 131bb3917fea
Step <span class="token number">4</span>/5 <span class="token builtin class-name">:</span> EXPOSE <span class="token number">8080</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> fa2f25977db7
Removing intermediate container fa2f25977db7
 ---<span class="token operator">&gt;</span> d98147377951
Step <span class="token number">5</span>/5 <span class="token builtin class-name">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;-jar&quot;</span>, <span class="token string">&quot;/app.jar&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> e1885e23773b
Removing intermediate container e1885e23773b
 ---<span class="token operator">&gt;</span> afb6b5f28a32
Successfully built afb6b5f28a32
Successfully tagged xiaofan666:latest

<span class="token comment"># 查看镜像</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ idea<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
myapp               v1                  afb6b5f28a32        <span class="token number">14</span> seconds ago      660MB
tomcat              latest              2ae23eb477aa        <span class="token number">8</span> days ago          647MB
redis               <span class="token number">5.0</span>.9-alpine3.11    3661c84ee9d0        <span class="token number">3</span> months ago        <span class="token number">29</span>.8MB
java                <span class="token number">8</span>                   d23bdf5b1b1b        <span class="token number">3</span> years ago         643MB

<span class="token comment"># 运行容器</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ idea<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name my-springboot-web myapp:v1</span>
fd9a353a80bfd61f6930c16cd92204532bfd734e003f3f9983b5128a27b0375e
<span class="token comment"># 查看运行起来的容器端口（因为我们启动的时候没有指定）</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ idea<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                     NAMES
fd9a353a80bf        xiaofan666          <span class="token string">&quot;java -jar /app.jar …&quot;</span>   <span class="token number">9</span> seconds ago       Up <span class="token number">8</span> seconds        <span class="token number">0.0</span>.0.0:32779-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   xiaofan-springboot-web
<span class="token comment"># 本地访问1</span>
<span class="token punctuation">[</span>root@iZ2zeg4ytp0whqtmxbsqiiZ idea<span class="token punctuation">]</span><span class="token comment"># curl localhost:32779/hello</span>
hello, world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h1 id="docker-compose"><a href="#docker-compose" class="header-anchor">#</a> Docker Compose</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p><strong>下载docker-compose命令</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 官网提供 （没有下载成功）</span>
<span class="token function">curl</span> -L <span class="token string">&quot;https://github.com/docker/compose/releases/download/1.26.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>&quot;</span> -o /usr/local/bin/docker-compose
<span class="token comment"># 国内地址</span>
<span class="token function">curl</span> -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>分配可执行权限</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200814210859399.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <h2 id="yaml规则"><a href="#yaml规则" class="header-anchor">#</a> yaml规则</h2> <p>https://docs.docker.com/compose/compose-file/#compose-file-structure-and-examples</p> <h2 id="实战-自己编写微服务上线"><a href="#实战-自己编写微服务上线" class="header-anchor">#</a> 实战：自己编写微服务上线</h2> <ul><li>编写项目微服务</li> <li>Dockerfile构建镜像</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>FROM java:8

COPY *.jar /app.jar

CMD <span class="token punctuation">[</span><span class="token string">&quot;--server.port=8080&quot;</span><span class="token punctuation">]</span>

EXPOSE <span class="token number">8080</span>

ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>, <span class="token string">&quot;-jar&quot;</span>, <span class="token string">&quot;/app.jar&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>docker-compose.yml编排项目</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>version '3.8'
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">myapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp<span class="token punctuation">:</span>v1
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> redis
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span>

  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;library/redis:alpine&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>丢到服务器运行 docker-compose up</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker-compose</span> down			<span class="token comment"># 关闭容器</span>
<span class="token function">docker-compose</span> up --build 	<span class="token comment"># 重新构建</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/20200815164213233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ZhbmppYW5oYWk=,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p> <p><img src="https://img-blog.csdnimg.cn/20200815163905484.png#pic_center" alt="img"></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/25.运维/50.Docker/03.Docker 高级实践篇.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/02/04, 06:18:55</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5ca863/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Docker 中级篇</div></a> <a href="/pages/8a7664/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Docker 网络模式和容器间通信</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/5ca863/" class="prev">Docker 中级篇</a></span> <span class="next"><a href="/pages/8a7664/">Docker 网络模式和容器间通信</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/075df8/"><div>
            Redis高级客户端Lettuce详解
            <!----></div></a> <span class="date">02-04</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/d09904/"><div>
            布隆过滤器
            <!----></div></a> <span class="date">02-03</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/8a3d2e/"><div>
            Redis高级客户端Lettuce详解
            <!----></div></a> <span class="date">02-03</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.b837e983.js" defer></script><script src="/assets/js/2.4c5c8fbd.js" defer></script><script src="/assets/js/72.5ba525c3.js" defer></script>
  </body>
</html>
