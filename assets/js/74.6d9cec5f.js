(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{554:function(s,a,t){"use strict";t.r(a);var e=t(20),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("使用 Docker 搭建 Redis Cluster，最重要的环节就是容器通信的问题，这一块我们在之前的文章中已经给大家解决了《"),t("a",{attrs:{href:"https://xie.infoq.cn/article/97355a6e7ac01bce8532d5ff5",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker 网络模式详解及容器间网络通信"),t("OutboundLink")],1),s._v("》，本篇文章主要练习使用多个容器完成 Redis Cluster 集群环境的搭建，顺便为学习 Docker Compose 铺铺路。俗话说没有对比就没有伤害，通过对比才能感受到 Docker Compose 的好处 😄。")]),s._v(" "),t("p",[s._v("关于 Redis Cluster 集群更多的内容请阅读《"),t("a",{attrs:{href:"https://xie.infoq.cn/article/fe070dcadf891d3d641132c36",target:"_blank",rel:"noopener noreferrer"}},[s._v("最通俗易懂的 Redis 架构模式详解"),t("OutboundLink")],1),s._v("》。")]),s._v(" "),t("p",[s._v("按照 Redis 官网：https://redis.io/topics/cluster-tutorial 的提示，为了使 Docker 与 Redis Cluster 兼容，您需要使用 Docker 的 "),t("code",[s._v("host")]),s._v(" 网络模式。")]),s._v(" "),t("p",[t("code",[s._v("host")]),s._v(" 网络模式需要在创建容器时通过参数 "),t("code",[s._v("--net host")]),s._v(" 或者 "),t("code",[s._v("--network host")]),s._v(" 指定，"),t("code",[s._v("host")]),s._v(" 网络模式可以让"),t("strong",[s._v("容器共享宿主机网络栈")]),s._v("，容器将不会虚拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/85/853745170f0475425dc6b2743c9963c4.png",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),t("p",[s._v("为了让环境更加真实，本文使用"),t("strong",[s._v("多机")]),s._v("环境：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("192.168.10.10")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("192.168.10.11")])])])]),s._v(" "),t("p",[s._v("每台机器所使用的基础设施环境如下：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("CentOS 7.8.2003")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("Docker version 19.03.12")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/03/0309ecfc01393c56c1e87247cc673c77.png",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建"}},[s._v("#")]),s._v(" 搭建")]),s._v(" "),t("p",[s._v("整体搭建步骤主要分为以下几步：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("下载 Redis 镜像（其实这步可以省略，因为创建容器时，如果本地镜像不存在，就会去远程拉取）；")])]),s._v(" "),t("li",[t("p",[s._v("编写 Redis 配置文件；")])]),s._v(" "),t("li",[t("p",[s._v("创建 Redis 容器；")])]),s._v(" "),t("li",[t("p",[s._v("创建 Redis Cluster 集群。")])])]),s._v(" "),t("h3",{attrs:{id:"编写-redis-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写-redis-配置文件"}},[s._v("#")]),s._v(" 编写 Redis 配置文件")]),s._v(" "),t("h4",{attrs:{id:"创建目录及文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建目录及文件"}},[s._v("#")]),s._v(" 创建目录及文件")]),s._v(" "),t("p",[s._v("分别在 "),t("code",[s._v("192.168.10.10")]),s._v(" 和 "),t("code",[s._v("192.168.10.11")]),s._v(" 两台机器上执行以下操作。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/docker-redis/redis-cluster\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换至指定目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/docker-redis/redis-cluster/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编写 redis-cluster.tmpl 文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" redis-cluster.tmpl\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"编写配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写配置文件"}},[s._v("#")]),s._v(" 编写配置文件")]),s._v(" "),t("p",[t("code",[s._v("192.168.10.10")]),s._v(" 机器的 "),t("code",[s._v("redis-cluster.tmpl")]),s._v(" 文件内容如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("port "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[t("code",[s._v("192.168.10.11")]),s._v(" 机器的 "),t("code",[s._v("redis-cluster.tmpl")]),s._v(" 文件内容如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("port "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[t("p",[t("code",[s._v("port")]),s._v("：节点端口；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("requirepass")]),s._v("：添加访问认证；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("masterauth")]),s._v("：如果主节点开启了访问认证，从节点访问主节点需要认证；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("protected-mode")]),s._v("：保护模式，默认值 yes，即开启。开启保护模式以后，需配置 "),t("code",[s._v("bind ip")]),s._v(" 或者设置访问密码；关闭保护模式，外部网络可以直接访问；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("daemonize")]),s._v("：是否以守护线程的方式启动（后台启动），默认 no；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("appendonly")]),s._v("：是否开启 AOF 持久化模式，默认 no；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("cluster-enabled")]),s._v("：是否开启集群模式，默认 no；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("cluster-config-file")]),s._v("：集群节点信息文件；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("cluster-node-timeout")]),s._v("：集群节点连接超时时间；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("cluster-announce-ip")]),s._v("：集群节点 IP，填写宿主机的 IP；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("cluster-announce-port")]),s._v("：集群节点映射端口；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("cluster-announce-bus-port")]),s._v("：集群节点总线端口。")])])]),s._v(" "),t("blockquote",[t("p",[s._v("每个 Redis 集群节点都需要打开"),t("strong",[s._v("两个 TCP 连接")]),s._v("。一个用于为客户端提供服务的正常 Redis TCP 端口，例如 6379。还有一个基于 6379 端口加 10000 的端口，比如 16379。")])]),s._v(" "),t("blockquote",[t("p",[s._v("第二个端口用于集群总线，这是一个使用二进制协议的节点到节点通信通道。节点使用集群总线进行故障检测、配置更新、故障转移授权等等。客户端永远不要尝试与集群总线端口通信，与正常的 Redis 命令端口通信即可，但是请确保防火墙中的这两个端口都已经打开，否则 Redis 集群节点将无法通信。")])]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("192.168.10.10")]),s._v(" 机器的 "),t("code",[s._v("redis-cluster")]),s._v(" 目录下执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6373")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" envsubst "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" redis-cluster.tmpl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("在 "),t("code",[s._v("192.168.10.11")]),s._v(" 机器的 "),t("code",[s._v("redis-cluster")]),s._v(" 目录下执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6374")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6376")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" envsubst "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" redis-cluster.tmpl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("上面两段 shell for 语句，意思就是循环创建 6371 ~ 6376 相关的目录及文件。")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("192.168.10.10")]),s._v(" 机器执行查看命令结果如下，如果没有 "),t("code",[s._v("tree")]),s._v(" 命令先安装 "),t("code",[s._v("yum install -y tree")]),s._v("。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/de/deef87b922ecb7bef310c9935b2d50c9.png",alt:"img"}})]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("192.168.10.11")]),s._v(" 机器执行查看命令结果如下。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/32/3270fddfb150fa9d1c8ff6e46025a822.png",alt:"img"}})]),s._v(" "),t("p",[s._v("以下内容为每个节点的配置文件详细信息。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis-cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/local/docker-redis/redis-cluster/637{1..3}/conf/redis.conf")]),s._v("\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16371")]),s._v("\n\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6372")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6372")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16372")]),s._v("\n\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6373")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6373")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16373")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost redis-cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/local/docker-redis/redis-cluster/637{4..6}/conf/redis.conf")]),s._v("\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6374")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6374")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16374")]),s._v("\n\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6375")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6375")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16375")]),s._v("\n\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6376")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v("\nprotected-mode no\ndaemonize no\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes.conf\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6376")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16376")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br")])]),t("h3",{attrs:{id:"创建-redis-容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建-redis-容器"}},[s._v("#")]),s._v(" 创建 Redis 容器")]),s._v(" "),t("h4",{attrs:{id:"创建容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建容器"}},[s._v("#")]),s._v(" 创建容器")]),s._v(" "),t("p",[s._v("将宿主机的 "),t("code",[s._v("6371 ~ 6376")]),s._v(" 之间的端口与 6 个 Redis 容器映射，并将宿主机的目录与容器内的目录进行映射（目录挂载）。记得指定网络模式，使用 "),t("code",[s._v("host")]),s._v(" 网络模式。")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("192.168.10.10")]),s._v(" 机器执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6373")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --restart always --name redis-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" --net "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /usr/local/docker-redis/redis-cluster/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf/redis.conf:/usr/local/etc/redis/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /usr/local/docker-redis/redis-cluster/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/data:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  redis redis-server /usr/local/etc/redis/redis.conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("在 "),t("code",[s._v("192.168.10.11")]),s._v(" 机器执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6374")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6376")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -di --restart always --name redis-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" --net "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /usr/local/docker-redis/redis-cluster/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/conf/redis.conf:/usr/local/etc/redis/redis.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /usr/local/docker-redis/redis-cluster/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v("/data:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  redis redis-server /usr/local/etc/redis/redis.conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("在 "),t("code",[s._v("192.168.10.10")]),s._v(" 机器执行 "),t("code",[s._v("docker ps -n 3")]),s._v(" 查看容器是否创建成功。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/76/76da732ac4cb08792c74c0465bc094c4.png",alt:"img"}})]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("192.168.10.11")]),s._v(" 机器执行 "),t("code",[s._v("docker ps -n 3")]),s._v(" 查看容器是否创建成功。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/db/dbb04889b514ffd1f0c542e316fb1899.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"创建-redis-cluster-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建-redis-cluster-集群"}},[s._v("#")]),s._v(" 创建 Redis Cluster 集群")]),s._v(" "),t("p",[s._v("随便进入一个容器节点，并进入 "),t("code",[s._v("/usr/local/bin/")]),s._v(" 目录：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-6371 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换至指定目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/bin/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("接下来我们就可以通过以下命令实现 Redis Cluster 集群的创建。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v(" --cluster create "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6371 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6372 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6373 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6374 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6375 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6376 --cluster-replicas "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("出现选择提示信息，输入 "),t("strong",[s._v("yes")]),s._v("，结果如下所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/c7/c7cf58473d1ecea9f5b925b9de5a38f6.png",alt:"img"}})]),s._v(" "),t("p",[s._v("集群创建成功如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/dc/dcc8671ab41d1647d62ff288db56581b.png",alt:"img"}})]),s._v(" "),t("p",[s._v("以下内容是创建集群时返回的详细信息，也就是上两幅图中的所有内容。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@localhost:/usr/local/bin"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -a 1234 --cluster create 192.168.10.10:6371 192.168.10.10:6372 192.168.10.10:6373 192.168.10.11:6374 192.168.10.11:6375 192.168.10.11:6376 --cluster-replicas 1")]),s._v("\nWarning: Using a password with "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-a'")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-u'")]),s._v(" option on the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line interface may not be safe.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Performing "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" slots allocation on "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" nodes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nMaster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Slots "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5460")]),s._v("\nMaster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Slots "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10922")]),s._v("\nMaster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Slots "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16383")]),s._v("\nAdding replica "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6376 to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6371\nAdding replica "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6373 to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6374\nAdding replica "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6375 to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6372\nM: 299cf79ddafc83dced27f628f1f82dac483fbc4e "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nM: ac805b90b6e20e26dc4268454bb2855beea6cc19 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nS: db35494fcc5db0c88d27da7885c817e6cdcc9373 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6373\n   replicates 7013270480d37eeab79b9cd0272e934d4548136a\nM: 7013270480d37eeab79b9cd0272e934d4548136a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6374\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nS: 8435e1b0d51f2690c5f94f9a5682a4ac34e94326 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6375\n   replicates ac805b90b6e20e26dc4268454bb2855beea6cc19\nS: 7b13c16fa6fe8e13cdc0b4846b87edffed55c62e "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6376\n   replicates 299cf79ddafc83dced27f628f1f82dac483fbc4e\nCan I "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" the above configuration? "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yes'")]),s._v(" to accept"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Nodes configuration updated\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Assign a different config epoch to each "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Sending CLUSTER MEET messages to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" the cluster\nWaiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the cluster to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Performing Cluster Check "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("using "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6371"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 299cf79ddafc83dced27f628f1f82dac483fbc4e "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 8435e1b0d51f2690c5f94f9a5682a4ac34e94326 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ac805b90b6e20e26dc4268454bb2855beea6cc19\nS: db35494fcc5db0c88d27da7885c817e6cdcc9373 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6373\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 7013270480d37eeab79b9cd0272e934d4548136a\nS: 7b13c16fa6fe8e13cdc0b4846b87edffed55c62e "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 299cf79ddafc83dced27f628f1f82dac483fbc4e\nM: 7013270480d37eeab79b9cd0272e934d4548136a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6374\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: ac805b90b6e20e26dc4268454bb2855beea6cc19 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All nodes agree about slots configuration.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check slots coverage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" slots covered.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br")])]),t("p",[s._v("至此一个高可用的 Redis Cluster 集群搭建完成，如下图所示，该集群中包含 6 个 Redis 节点，3 主 3 从。三个主节点会分配槽，处理客户端的命令请求，而从节点可用在主节点故障后，顶替主节点。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/27/27ad2d63da3a5939ff37f79c0baa3f49.png",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"查看集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看集群状态"}},[s._v("#")]),s._v(" 查看集群状态")]),s._v(" "),t("p",[s._v("我们先进入容器，然后通过一些集群常用的命令查看一下集群的状态。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-6371 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换至指定目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/bin/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"检查集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查集群状态"}},[s._v("#")]),s._v(" 检查集群状态")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11:6375\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/38/380c3a75203f3be959ca0dc97bdb9af6.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"查看集群信息和节点信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看集群信息和节点信息"}},[s._v("#")]),s._v(" 查看集群信息和节点信息")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接至集群某个节点")]),s._v("\nredis-cli -c -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.11 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6376")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群信息")]),s._v("\ncluster info\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群结点信息")]),s._v("\ncluster nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/b9/b9446bb132c290dd0914002e945918c7.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"set-get"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#set-get"}},[s._v("#")]),s._v(" SET/GET")]),s._v(" "),t("p",[s._v("在 6371 节点中执行写入和读取，命令如下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器并连接至集群某个节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it redis-6371 /usr/local/bin/redis-cli -c -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.10 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" name mrhelloworld\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" aaa "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" bbb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取数据")]),s._v("\nget name\nget aaa\nget bbb\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/22/22fcd3fcaf114acdf4088a37f52d4739.png",alt:"img"}})]),s._v(" "),t("p",[s._v("别着急，让我来解释一下上图中的操作过程：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("首先进入容器并连接至集群某个节点；")])]),s._v(" "),t("li",[t("p",[s._v("然后执行"),t("strong",[s._v("第一个")]),s._v(" set 命令 "),t("code",[s._v("set name mrhelloworld")]),s._v("，"),t("code",[s._v("name")]),s._v(" 键根据哈希函数运算以后得到的值为 "),t("code",[s._v("[5798]")]),s._v("。当前集群环境的槽分配情况为："),t("code",[s._v("[0-5460] 6371 节点")]),s._v("，"),t("code",[s._v("[5461-10922] 6374 节点")]),s._v("，"),t("code",[s._v("[10923-16383] 6372 节点")]),s._v("，所以该键的存储就被分配到了 "),t("strong",[s._v("6374")]),s._v(" 节点上；")])]),s._v(" "),t("li",[t("p",[s._v("再来看"),t("strong",[s._v("第二个")]),s._v(" set 命令 "),t("code",[s._v("set aaa")]),s._v("，这里大家可能会有一些疑问，为什么看不到 "),t("code",[s._v("aaa")]),s._v(" 键根据哈希函数运算以后得到的值？因为刚才重定向至 "),t("strong",[s._v("6374")]),s._v(" 节点插入了数据，此时如果还有数据插入，正好键根据哈希函数运算以后得到的值也还在该节点的范围内，那么直接插入数据即可；")])]),s._v(" "),t("li",[t("p",[s._v("接着是"),t("strong",[s._v("第三个")]),s._v(" set 命令 "),t("code",[s._v("set bbb")]),s._v("，"),t("code",[s._v("bbb")]),s._v(" 键根据哈希函数运算以后得到的值为 "),t("code",[s._v("[5287]")]),s._v("，所以该键的存储就被分配到了 "),t("strong",[s._v("6371")]),s._v(" 节点上；")])]),s._v(" "),t("li",[t("p",[s._v("然后是读取操作，"),t("strong",[s._v("第四个")]),s._v("命令 "),t("code",[s._v("get name")]),s._v("，"),t("code",[s._v("name")]),s._v(" 键根据哈希函数运算以后得到的值为 "),t("code",[s._v("[5798]")]),s._v("，被重定向至 "),t("strong",[s._v("6374")]),s._v(" 节点读取；")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("第五个")]),s._v("命令 "),t("code",[s._v("get aaa")]),s._v("，"),t("code",[s._v("aaa")]),s._v(" 键根据哈希函数运算以后得到的值也在 "),t("strong",[s._v("6374")]),s._v(" 节点，直接读取；")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("第六个")]),s._v("命令 "),t("code",[s._v("get bbb")]),s._v("，"),t("code",[s._v("bbb")]),s._v(" 键根据哈希函数运算以后得到的值为 "),t("code",[s._v("[5287]")]),s._v("，被重定向至 "),t("strong",[s._v("6371")]),s._v(" 节点读取。")])])]),s._v(" "),t("p",[s._v("通过以上操作我们得知 "),t("code",[s._v("name")]),s._v(" 键的存储被分配到了 6374 节点，如果直接连接 6374 节点并获取该值会怎么样？没错，不需要重定向节点，因为数据就在该节点，所以直接读取返回。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/2e/2e60fc44016d5c31017c54bb8449b711.png",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"客户端连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端连接"}},[s._v("#")]),s._v(" 客户端连接")]),s._v(" "),t("p",[s._v("最后来一波客户端连接操作，随便哪个节点，看看可否通过外部访问 Redis Cluster 集群。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/c4/c428ca8697221393de63bd3beb228b14.png",alt:"img"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/8e/8e61f525269508e86a873c5bedc45f07.png",alt:"img"}})]),s._v(" "),t("p",[s._v("至此使用多机环境多个容器搭建 Redis Cluster 集群环境就到这里，其实整体搭建过程不算特别麻烦，因为：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("创建 Redis 集群需要用到 Ruby，否则就得自己关联节点构建集群，自己分配槽；")])]),s._v(" "),t("li",[t("p",[s._v("如果使用 Ruby 构建 Redis 集群，就需要安装 Ruby 环境；")])]),s._v(" "),t("li",[t("p",[s._v("而 Redis 从 5 版本开始可以直接使用 "),t("code",[s._v("redis-cli")]),s._v(" 命令创建集群了，就省去了很多麻烦事；")])]),s._v(" "),t("li",[t("p",[s._v("我们还使用了 shell for 循环语句简化了构建过程，否则那些语句一条条执行也够你闹心的。")])])]),s._v(" "),t("p",[s._v("综上所述，有没有更简单的办法呢？当然有了，不然我在这跟你卖什么关子。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/infoq/0a/0a75c5102479dbd2d534fdcdbba0f41d.jpeg?x-oss-process=image/resize,p_80/auto-orient,1",alt:"img"}})]),s._v(" "),t("p",[s._v("Docker Compose 就可以解决这个问题。后面我们先学习一下什么是 Docker Compose，然后使用 Docker Compose 再来搭建一遍 Redis Cluster 集群环境，感受感受这前后的区别。")]),s._v(" "),t("p",[s._v("[]: https://xie.infoq.cn/article/a5536b928edd12beb32fcabf9")])])}),[],!1,null,null,null);a.default=n.exports}}]);